<beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.springframework.org/schema/beans 
                        http://www.springframework.org/schema/beans/spring-beans.xsd
                        http://www.springframework.org/schema/context  
                        http://www.springframework.org/schema/context/spring-context-3.0.xsd">

    <bean id="schema_org_description" class="org.dataone.cn.indexer.annotation.SparqlField">
        <constructor-arg name="name" value="abstract" />
        <constructor-arg name="query">
            <value>
                <![CDATA[
                PREFIX rdf:  <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
                PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
                PREFIX SO:   <https://schema.org/>

                SELECT ( ?description as ?abstract )
                WHERE {
                    ?datasetId rdf:type       SO:Dataset .
                    ?datasetId SO:description ?description   .
                    }
                ]]>
            </value>
        </constructor-arg>
    </bean>
    
    <bean id="schema_org_name" class="org.dataone.cn.indexer.annotation.SparqlField">
        <constructor-arg name="name" value="title" />
        <constructor-arg name="query">
            <value>
                <![CDATA[
                PREFIX rdf:  <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
                PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
                PREFIX SO:   <https://schema.org/>
                SELECT ( ?name as ?title )
                WHERE {
                    ?datasetId rdf:type SO:Dataset .
                    ?datasetId SO:name ?name .
                    }
                 ]]>
            </value>
        </constructor-arg>
    </bean>

    <bean id="schema_org_alternateName" class="org.dataone.cn.indexer.annotation.SparqlField">
        <constructor-arg name="name" value="label" />
        <constructor-arg name="query">
            <value>
                <![CDATA[
                PREFIX rdf:  <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
                PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
                PREFIX SO:   <https://schema.org/>

                SELECT ?label
                WHERE {
                    ?datasetId rdf:type SO:Dataset .
                    ?datasetId SO:alternateName ?label .
                }
                ]]>
            </value>
        </constructor-arg>
    </bean>

    <!-- Extract one SO:creator to populate Solr 'author'. The convention used is to extract
         the first creator in document order and use that. The JSON-LD list must be ordered
         by using '@list', so that an ordered list is created when converted to an RDF model.
         Also, in order to process the list efficiently in SPARQL, the Jena ARQ 'list' facility
         is used for the query, vs a native SPARQL query, which would take significantly longer.
    -->
    <bean id="schema_org_creator" class="org.dataone.cn.indexer.annotation.SparqlField">
        <constructor-arg name="name" value="author" />
        <constructor-arg name="query">
            <value>
                <![CDATA[
                PREFIX rdf:  <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
                PREFIX list: <http://jena.hpl.hp.com/ARQ/list#>
                PREFIX SO:   <https://schema.org/>

                SELECT (?name as ?author)
                WHERE {
                    ?dsId rdf:type SO:Dataset .
                    ?dsId SO:creator ?list .
                    ?list list:index (?pos ?member) .
                    ?member SO:name ?name .
                }
                order by (?pos)
                limit 1
                ]]>
            </value>
        </constructor-arg>
    </bean>

    <bean id="schema_org_givenName" class="org.dataone.cn.indexer.annotation.SparqlField">
        <constructor-arg name="name" value="authorGivenName" />
        <constructor-arg name="query">
            <value>
                <![CDATA[
                PREFIX rdf:  <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
                PREFIX list: <http://jena.hpl.hp.com/ARQ/list#>
                PREFIX SO:   <https://schema.org/>

                SELECT (?givenName as ?authorGivenName)
                WHERE {
                    ?dsId rdf:type SO:Dataset .
                    ?dsId SO:creator ?list .
                    ?list list:index (?pos ?member) .
                    ?member SO:givenName ?givenName .
                }
                order by (?pos)
                limit 1
                ]]>
            </value>
        </constructor-arg>
    </bean>

    <bean id="schema_org_familyName" class="org.dataone.cn.indexer.annotation.SparqlField">
        <constructor-arg name="name" value="authorLastName" />
        <constructor-arg name="query">
            <value>
                <![CDATA[
                    PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
                    PREFIX list: <http://jena.hpl.hp.com/ARQ/list#>
                    PREFIX SO:  <https://schema.org/>

                    SELECT (?familyName as ?authorLastName)
                    WHERE {
                        ?dsId rdf:type SO:Dataset .
                        ?dsId SO:creator ?list .
                        ?list list:index (?pos ?member) .
                        ?member SO:familyName ?familyName .
                    }
                    order by (?pos)
                    limit 1
                ]]>
            </value>
        </constructor-arg>
    </bean>

    <bean id="schema_org_creator_list" class="org.dataone.cn.indexer.annotation.SparqlField">
        <constructor-arg name="name" value="origin" />
        <constructor-arg name="query">
            <value>
                <![CDATA[
                PREFIX rdf:  <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
                PREFIX list: <http://jena.hpl.hp.com/ARQ/list#>
                PREFIX SO:   <https://schema.org/>

                SELECT (?name as ?origin)
                WHERE {
                    ?dsId rdf:type SO:Dataset .
                    ?dsId SO:creator ?list .
                    ?list list:index (?pos ?member) .
                    ?member SO:name ?name .
                }
                order by (?pos)
                ]]>
            </value>
        </constructor-arg>
        <!--&lt;!&ndash; <property name="multivalued" value="true" /> &ndash;&gt;-->
    </bean>

<!--    &lt;!&ndash; Extract 'SO:hasPart' properties from the top level 'SO:Dataset' property &ndash;&gt;-->
<!--    <bean id="schema_org_hasPart" class="org.dataone.cn.indexer.annotation.SparqlField">-->
<!--        <constructor-arg name="name" value="hasPart" />-->
<!--        <constructor-arg name="query">-->
<!--            <value>-->
<!--                <![CDATA[-->
<!--                    PREFIX rdf:  <http://www.w3.org/1999/02/22-rdf-syntax-ns#>-->
<!--                    PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>-->
<!--                    PREFIX SO:   <https://schema.org/>-->
<!--                    SELECT ?hasPart-->
<!--                    WHERE {-->
<!--                      ?datasetId rdf:type SO:Dataset .-->
<!--                      {-->
<!--                        ?datasetId SO:hasPart ?node .-->
<!--                        ?node      rdf:type   SO:Dataset .-->
<!--                        ?node      SO:name    ?hasPart .-->
<!--                      }-->
<!--                      UNION-->
<!--                      {-->
<!--                        ?datasetId SO:hasPart ?hasPart .-->
<!--                        # SO:Dataset can also appear as a sub-element of the 'SO:hasPart'-->
<!--                        # so exclude those from the query result.-->
<!--                        FILTER NOT EXISTS { ?hasPart rdf:type SO:Dataset . }-->
<!--                      }-->
<!--                    }-->
<!--                ]]>-->
<!--            </value>-->
<!--        </constructor-arg>-->
<!--        &lt;!&ndash; <property name="multivalued" value="true" /> &ndash;&gt;-->
<!--    </bean>-->

<!--    <bean id="schema_org_keywords" class="org.dataone.cn.indexer.annotation.SparqlField">-->
<!--        <constructor-arg name="name" value="keywords" />-->
<!--        <constructor-arg name="query">-->
<!--            <value>-->
<!--                <![CDATA[-->
<!--                    PREFIX rdf:  <http://www.w3.org/1999/02/22-rdf-syntax-ns#>-->
<!--                    PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>-->
<!--                    PREFIX SO:   <https://schema.org/>-->
<!--                      SELECT ?keywords-->
<!--                      WHERE {-->
<!--                        ?datasetId rdf:type    SO:Dataset .-->
<!--                        ?datasetId SO:keywords ?keywords .-->
<!--                      }-->
<!--                ]]>-->
<!--            </value>-->
<!--        </constructor-arg>-->
<!--        &lt;!&ndash; <property name="multivalued" value="true" /> &ndash;&gt;-->
<!--    </bean>-->

    <!-- Extract bounding box coordinates from a 'SO:spatialCoverage' property. -->
    <bean id="schema_org_geoShape_box_south" class="org.dataone.cn.indexer.annotation.SparqlField">
        <constructor-arg name="name" value="southBoundCoord" />
        <constructor-arg name="query">
            <value>
                <![CDATA[
                    PREFIX rdf:  <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
                    PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
                    PREFIX SO:   <https://schema.org/>

                    SELECT ?southBoundCoord
                      WHERE {
                        ?datasetId rdf:type           SO:Dataset .
                        ?datasetId SO:spatialCoverage ?spatial .
                        ?spatial   rdf:type           SO:Place .
                        ?spatial   SO:geo             ?geo .
                        ?geo       rdf:type           SO:GeoShape .
                        ?geo       SO:box             ?box .
                        bind(strbefore(?box, " ") as ?southBoundCoord)
                      }
                ]]>
            </value>
        </constructor-arg>
    </bean>

    <!-- Extract bounding box coordinates from a 'SO:spatialCoverage' property. -->
    <bean id="schema_org_geoShape_box_west" class="org.dataone.cn.indexer.annotation.SparqlField">
        <constructor-arg name="name" value="westBoundCoord" />
        <constructor-arg name="query">
            <value>
                <![CDATA[
                    PREFIX rdf:  <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
                    PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
                    PREFIX SO:   <https://schema.org/>

                    SELECT ?westBoundCoord
                      WHERE {
                        ?datasetId rdf:type           SO:Dataset .
                        ?datasetId SO:spatialCoverage ?spatial .
                        ?spatial   rdf:type           SO:Place .
                        ?spatial   SO:geo             ?geo .
                        ?geo       rdf:type           SO:GeoShape .
                        ?geo       SO:box             ?box .
                        bind(strbefore(?box, " ") as ?southBoundCoord)
                        bind(strafter(?box, " ") as ?rest)
                        bind(strbefore(?rest, " ") as ?westBoundCoord)
                      }
                ]]>
            </value>
        </constructor-arg>
    </bean>

    <!-- Extract bounding box coordinates from a 'SO:spatialCoverage' property. -->
    <bean id="schema_org_geoShape_box_north" class="org.dataone.cn.indexer.annotation.SparqlField">
        <constructor-arg name="name" value="northBoundCoord" />
        <constructor-arg name="query">
            <value>
                <![CDATA[
                    PREFIX rdf:  <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
                    PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
                    PREFIX SO:   <https://schema.org/>

                    SELECT ?northBoundCoord
                      WHERE {
                        ?datasetId rdf:type           SO:Dataset .
                        ?datasetId SO:spatialCoverage ?spatial .
                        ?spatial   rdf:type           SO:Place .
                        ?spatial   SO:geo             ?geo .
                        ?geo       rdf:type           SO:GeoShape .
                        ?geo       SO:box             ?box .
                        bind(strbefore(?box, " ") as ?southBoundCoord)
                        bind(strafter(?box, " ") as ?rest)
                        bind(strbefore(?rest, " ") as ?westBoundCoord)
                        bind(strafter(?rest, " ") as ?rest2)
                        bind(strbefore(?rest2, " ") as ?northBoundCoord)
                      }
                ]]>
            </value>
        </constructor-arg>
    </bean>

    <!-- Extract bounding box coordinates from a 'SO:spatialCoverage' property. -->
    <bean id="schema_org_geoShape_box_east" class="org.dataone.cn.indexer.annotation.SparqlField">
        <constructor-arg name="name" value="eastBoundCoord" />
        <constructor-arg name="query">
            <value>
                <![CDATA[
                    PREFIX rdf:  <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
                    PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
                    PREFIX SO:   <https://schema.org/>

                    SELECT ?eastBoundCoord
                      WHERE {
                        ?datasetId rdf:type           SO:Dataset .
                        ?datasetId SO:spatialCoverage ?spatial .
                        ?spatial   rdf:type           SO:Place .
                        ?spatial   SO:geo             ?geo .
                        ?geo       rdf:type           SO:GeoShape .
                        ?geo       SO:box             ?box .
                        bind(strbefore(?box, " ") as ?southBoundCoord)
                        bind(strafter(?box, " ") as ?rest)
                        bind(strbefore(?rest, " ") as ?westBoundCoord)
                        bind(strafter(?rest, " ") as ?rest2)
                        bind(strbefore(?rest2, " ") as ?northBoundCoord)
                        bind(strafter(?rest2, " ") as ?eastBoundCoord)
                      }
                ]]>
            </value>
        </constructor-arg>
    </bean>

    <!-- Extract 'SO:spatialCoverage'. This property can have several different forms, for different
         types of spatial coverage representations. if the value is simple text (i.e. not SO:Place),
         then it should be assigned to Solr 'namedLocation' field,
         e.g. '"spatialCoverage:" "Tahoe City, CA"'.
    -->
    <bean id="schema_org_spatialCoverage" class="org.dataone.cn.indexer.annotation.SparqlField">
        <constructor-arg name="name" value="namedLocation" />
        <constructor-arg name="query">
            <value>
                <![CDATA[
                    PREFIX rdf:  <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
                    PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
                    PREFIX SO:   <https://schema.org/>

                    SELECT ?namedLocation
                    WHERE {
                        ?datasetId rdf:type SO:Dataset .
                        ?datasetId SO:spatialCoverage ?namedLocation .
                        FILTER NOT EXISTS { ?namedLocaiton rdf:type SO:Place . }
                    }
                ]]>
            </value>
        </constructor-arg>
    </bean>

    <bean id="schema_org_temporalCoverage_begin" class="org.dataone.cn.indexer.annotation.SparqlField">
        <constructor-arg name="name" value="beginDate" />
        <constructor-arg name="query">
            <value>
                <![CDATA[
                    PREFIX rdf:  <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
                    PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
                    PREFIX SO:   <https://schema.org/>

                    SELECT
                        # possible formats: "start/end", "start/..", "start"
                        (if(contains(?dates, "/"), strbefore(?dates, "/"), ?dates) as ?beginDate)
                    WHERE {
                        ?datasetId rdf:type SO:Dataset .
                        ?datasetId SO:temporalCoverage ?dates .
                    }
                ]]>
            </value>
        </constructor-arg>
        <property name="converter" ref="dateConverter" />
    </bean>

    <bean id="schema_org_temporalCoverage_end" class="org.dataone.cn.indexer.annotation.SparqlField">
        <constructor-arg name="name" value="endDate" />
        <constructor-arg name="query">
            <value>
                <![CDATA[
                    PREFIX rdf:  <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
                    PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
                    PREFIX SO:   <https://schema.org/>

                    SELECT
                        # possible formats: "start/end", "start/..", "start"
                        (if(contains(?dates, "/"), strafter(?dates, "/"), "") as ?endDate)
                    WHERE {
                        ?datasetId rdf:type SO:Dataset .
                        ?datasetId SO:temporalCoverage ?dates .
                    }
                ]]>
            </value>
        </constructor-arg>
        <property name="converter" ref="dateConverter" />
    </bean>

<!--    <bean id="schema_org_variableMeasured" class="org.dataone.cn.indexer.annotation.SparqlField">-->
<!--        <constructor-arg name="name" value="property" />-->
<!--        <constructor-arg name="query">-->
<!--            <value>-->
<!--                <![CDATA[-->
<!--                    PREFIX rdf:  <http://www.w3.org/1999/02/22-rdf-syntax-ns#>-->
<!--                    PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>-->
<!--                    PREFIX SO:   <https://schema.org/>-->

<!--                    SELECT (?variableMeasured as ?parameter)-->
<!--                    WHERE {-->
<!--                       ?datasetId rdf:type SO:Dataset .-->
<!--                       {-->
<!--                           ?datasetId SO:variableMeasured ?variable .-->
<!--                           ?variable  rdf:type            SO:PropertyValue .-->
<!--                           ?variable  SO:name             ?variableMeasured .-->
<!--                       }-->
<!--                       UNION-->
<!--                       {-->
<!--                           ?datasetId SO:variableMeasured ?variableMeasured .-->
<!--                           FILTER NOT EXISTS { ?parameter rdf:type SO:PropertyValue . }-->
<!--                       }-->
<!--                   }-->
<!--                ]]>-->
<!--            </value>-->
<!--        </constructor-arg>-->
<!--        &lt;!&ndash; <property name="multivalued" value="true" /> &ndash;&gt;-->
<!--    </bean>-->

    <bean id="schema_org_version" class="org.dataone.cn.indexer.annotation.SparqlField">
        <constructor-arg name="name" value="edition" />
        <constructor-arg name="query">
            <value>
                <![CDATA[
                    PREFIX rdf:     <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
                    PREFIX rdfs:    <http://www.w3.org/2000/01/rdf-schema#>
                    PREFIX schema:  <https://schema.org/>

                    SELECT ( ?version as ?edition )

                    WHERE {
                        ?datasetId rdf:type schema:Dataset .
                        ?datasetId schema:version ?version .
                    }
                ]]>
            </value>
        </constructor-arg>
    </bean>

    <bean id="schema_org_url" class="org.dataone.cn.indexer.annotation.SparqlField">
        <constructor-arg name="name" value="serviceEndPoint" />
        <constructor-arg name="query">
            <value>
                <![CDATA[
                    PREFIX rdf:     <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
                    PREFIX rdfs:    <http://www.w3.org/2000/01/rdf-schema#>
                    PREFIX SO:  <https://schema.org/>

                    SELECT ( ?url as ?serviceEndpoint )

                    WHERE {
                        ?datasetId rdf:type SO:Dataset .
                        ?datasetId SO:url ?url .
                    }
                ]]>
            </value>
        </constructor-arg>
    </bean>
</beans>
